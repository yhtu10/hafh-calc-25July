
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>HafH 活動計算機</title>
    <style>
        body { font-family: "Noto Sans TC", sans-serif; padding: 20px; background: #f9f9f9; }
        h1 { color: #333; }
        label { display: block; margin-top: 10px; }
        input { margin-bottom: 10px; padding: 5px; width: 200px; }
        button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        .result { margin-top: 20px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
        .footer { font-size: 0.9em; color: #666; margin-top: 40px; line-height: 1.6; }
    </style>
    <script>
        function formatCurrency(num) {
            return "NT$" + num.toLocaleString();
        }

        function getMinCostPackage(diff) {
            const packages = [
                { label: "新手包 100 Ⓗ", hc: 100, cost: 720, type: "starter" },
                { label: "新手包 300 Ⓗ", hc: 300, cost: 1920, type: "starter" },
                { label: "指定代幣組合 200 Ⓗ", hc: 200, cost: 1440, type: "regular" },
                { label: "指定代幣組合 300 Ⓗ", hc: 300, cost: 2160, type: "regular" },
            ];

            let result = [];
            function search(current, remaining, used) {
                if (remaining <= 0) {
                    if (!result.length || current < result.reduce((a, b) => a + b.cost, 0)) {
                        result = [...used];
                    }
                    return;
                }
                for (let p of packages) {
                    if ((p.type === "starter" && used.some(u => u.type === "starter" && u.hc === p.hc)) ||
                        (p.type === "regular" && used.filter(u => u.type === "regular" && u.hc === p.hc).length >= 2)) {
                        continue;
                    }
                    search(current + p.cost, remaining - p.hc, [...used, p]);
                }
            }
            search(0, diff, []);
            return result;
        }

        function calculate() {
            const hafhHC = parseInt(document.getElementById("hafhHC").value);
            const officialPrice = parseInt(document.getElementById("officialPrice").value);

            const output = document.getElementById("output");
            output.innerHTML = "";

            let resultHTML = "";

            // 方案 A：單人入住
            let hcNeededA = hafhHC;
            let hcStartA = 300;
            let hcDiffA = hcNeededA - hcStartA;
            let costItemsA = [];
            if (hcDiffA > 0) {
                const add = getMinCostPackage(hcDiffA);
                costItemsA = add.map(x => x.label + "（" + formatCurrency(x.cost) + "）");
            }
            let totalCostA = 439 + (costItemsA.reduce((a, b) => a + parseInt(b.match(/NT\$(\d+)/)[1].replace(/,/g, "")), 0));
            resultHTML += `<div class="result"><h2>方案 A｜新會員單人入住</h2>`;
            resultHTML += `<p>帳號開局為 300 Ⓗ，實際需要 ${hcNeededA} Ⓗ，差額 ${hcDiffA > 0 ? hcDiffA : 0} Ⓗ</p>`;
            if (hcDiffA > 0) resultHTML += `<p>加購代幣組合：${costItemsA.join("＋")}</p>`;
            resultHTML += `<p>首月會費：${formatCurrency(439)}</p>`;
            resultHTML += `<p>總成本：約 ${formatCurrency(totalCostA)}</p>`;
            resultHTML += `<p>📉 為官網價格的 ${(totalCostA / officialPrice * 100).toFixed(1)}% 價格</p></div>`;

            // 方案 B：雙人分攤
            let hcEachB = Math.ceil(hafhHC / 2);
            let hcDiffB = hcEachB - 300;
            let costItemsB = [];
            if (hcDiffB > 0) {
                const add = getMinCostPackage(hcDiffB);
                costItemsB = add.map(x => x.label + "（" + formatCurrency(x.cost) + "）");
            }
            let totalEachB = 439 + (costItemsB.reduce((a, b) => a + parseInt(b.match(/NT\$(\d+)/)[1].replace(/,/g, "")), 0));
            let totalCostB = totalEachB * 2;
            resultHTML += `<div class="result"><h2>方案 B｜新會員雙人入住分攤</h2>`;
            resultHTML += `<p>房價 ${hafhHC} Ⓗ 拆半後每人需 ${hcEachB} Ⓗ</p>`;
            resultHTML += `<p>新會員帳號開局皆為 300 Ⓗ，差額 ${hcDiffB > 0 ? hcDiffB : 0} Ⓗ／人</p>`;
            if (hcDiffB > 0) resultHTML += `<p>每人加購代幣組合：${costItemsB.join("＋")}</p>`;
            resultHTML += `<p>首月會費：${formatCurrency(439)}／人</p>`;
            resultHTML += `<p>總成本：約 ${formatCurrency(totalCostB)}（${formatCurrency(totalEachB)}／人）</p>`;
            resultHTML += `<p>📉 為官網價格的 ${(totalCostB / officialPrice * 100).toFixed(1)}% 價格</p></div>`;

            // 方案 C：老會員邀請朋友
            let hcNeededC = Math.ceil(hafhHC / 2);
            let costItemsC = getMinCostPackage(hcNeededC).map(x => x.label + "（" + formatCurrency(x.cost) + "）");
            let totalCostC = 439 + costItemsC.reduce((a, b) => a + parseInt(b.match(/NT\$(\d+)/)[1].replace(/,/g, "")), 0) + 2880;
            resultHTML += `<div class="result"><h2>方案 C｜老會員邀請朋友一起住</h2>`;
            resultHTML += `<p>老會員與朋友各需 ${hcNeededC} Ⓗ</p>`;
            resultHTML += `<p>老會員購買指定代幣組合兩組 200 Ⓗ（${formatCurrency(1440)} × 2 = ${formatCurrency(2880)}）</p>`;
            resultHTML += `<p>朋友首次加入花費：${formatCurrency(439)}</p>`;
            resultHTML += `<p>朋友需加購代幣組合：${costItemsC.join("＋")}</p>`;
            resultHTML += `<p>總成本：約 ${formatCurrency(totalCostC)}</p>`;
            resultHTML += `<p>📉 為官網價格的 ${(totalCostC / officialPrice * 100).toFixed(1)}% 價格</p></div>`;

            // 結尾提醒
            resultHTML += `<div class="footer"><strong>溫馨提醒：</strong><br>
            1. 此試算頁面為粗略估算，為求謹慎請自行依照邏輯再次試算一遍。<br>
            2. 付費加入當天為結算日，且為第一次扣款。到第三次扣款時，帳號會升級為 Silver VIP，享有每筆訂房 95 折。<br>
            3. 有預約的狀況下無法變更為休眠會籍，若預約日期距離現在還會經過一次結算日，則會有扣款並同時有 200 Ⓗ 入帳。
            </div>`;

            output.innerHTML = resultHTML;
        }
    </script>
</head>
<body>
    <h1>HafH Ⓗ 活動計算機（最省成本推薦）</h1>
    <p>提醒：新會員預設帳戶中有 300 Ⓗ，所有計算以此為前提。請填寫符合相同條件（日期、人數、取消規則）且為新台幣的金額。</p>
    <label>HafH 所需 Ⓗ 數：</label>
    <input id="hafhHC" type="number" value="750">
    <label>官網價格（NT$）：</label>
    <input id="officialPrice" type="number" value="4400">
    <button onclick="calculate()">計算</button>
    <div id="output"></div>
</body>
</html>
